name: Update Profile README with Blog Posts

on:
  schedule:
    - cron: "0 0 * * *" # ÊØèÂ§©ÂÆöÊó∂Ëß¶Âèë
  workflow_dispatch: # ÊâãÂä®Ëß¶Âèë

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      # 1. ÂÆâË£Ö Python ‰æùËµñÂπ∂Ëß£Êûê RSS
      - name: Fetch and parse RSS feed
        run: |
          echo "Installing feedparser and fetching RSS feed..."
          pip install feedparser
          echo "
import feedparser

# RSS Ê∫êÂú∞ÂùÄ
rss_url = 'https://mikalasa.github.io/my-blog/rss.xml'
feed = feedparser.parse(rss_url)

# ÊûÑÂª∫ Markdown Ê†ºÂºèÁöÑÊñáÁ´†ÂàóË°®
articles = '## üìö ÊúÄÊñ∞ÂçöÂÆ¢ÊñáÁ´†\n'
for entry in feed.entries[:5]:  # Ëé∑ÂèñÂâç 5 ÁØáÊñáÁ´†
    title = entry.title
    link = entry.link
    pub_date = entry.published  # ÂèëÂ∏ÉÊó∂Èó¥
    articles += f'- [{title}]({link}) - {pub_date}\n'

# Â∞ÜÊñáÁ´†ÂàóË°®ÂÜôÂÖ•Êñá‰ª∂
with open('articles_list.md', 'w') as f:
    f.write(articles)
" > script.py
          python3 script.py
          echo "Generated articles_list.md:"
          cat articles_list.md

      # 2. Ê£ÄÂá∫ Profile ‰ªìÂ∫ì
      - name: Checkout profile repository
        uses: actions/checkout@v3
        with:
          repository: Mikalasa/Mikalasa
          token: ${{ secrets.GITHUB_TOKEN }}
          path: profile_repo

      # 3. Êõ¥Êñ∞ README Êñá‰ª∂
      - name: Update README
        run: |
          cd profile_repo
          sed -i '/<!-- BLOG-POST-LIST:START -->/,/<!-- BLOG-POST-LIST:END -->/c\<!-- BLOG-POST-LIST:START -->\n'"$(cat ../articles_list.md)"'\n<!-- BLOG-POST-LIST:END -->' README.md
          echo "Updated README.md content:"
          cat README.md

      # 4. Êèê‰∫§Êõ¥Êîπ
      - name: Commit and push changes
        run: |
          cd profile_repo
          git config --local user.name "GitHub Actions"
          git config --local user.email "actions@github.com"
          git add README.md
          git commit -m "Update articles list in README" || echo "No changes to commit"
          git push origin main || echo "No changes to push"
